import{c as _,r as l,j as e,b as f,A as T,m,e as b,C as v,d as I,g as P,R as D}from"./tailwind-Bw2E9ve4.js";const J=_("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),M=()=>{const[i,o]=l.useState("idle"),[u,c]=l.useState("idle"),[h,x]=l.useState("idle"),[s,d]=l.useState(null),[y,C]=l.useState(""),a=document.getElementById("wprai-rescue-root"),j=(a==null?void 0:a.dataset.endpoint)||"",k=(a==null?void 0:a.dataset.emailEndpoint)||"",p=(a==null?void 0:a.dataset.token)||"",E=async()=>{o("analyzing");try{const r=await(await fetch(j,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:p})})).text();try{const t=JSON.parse(r);t.success||t.status==="ok"?(d(t),o("fixed")):(o("error"),d({error:t.message||"Unknown server error"}))}catch(t){console.error("JSON Parse Error:",t),o("error"),d({error:"Invalid JSON response: "+r.substring(0,200)+"..."})}}catch(n){console.error(n),o("error");const r=n.message||"Unknown error";d({error:r})}},O=async()=>{c("fixing");try{const r=await(await fetch(j,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:p,apply_fix:!0})})).text();try{const t=JSON.parse(r);(t.success||t.status==="ok")&&t.fix_applied?(c("fixed"),d({...s,fix_applied:!0,actions:t.actions})):(c("error"),console.error("Fix failed:",t))}catch(t){console.error("JSON Parse Error:",t,r),c("error")}}catch{c("error")}},R=async()=>{var n,r;x("generating");try{const w=await(await fetch(k,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:p,context:"rescue",issue:((r=(n=s==null?void 0:s.suspicions)==null?void 0:n[0])==null?void 0:r.slug)||"Unknown issue"})})).json();w.status==="ok"?(C(w.email),x("generated")):x("error")}catch{x("error")}},A=()=>{navigator.clipboard.writeText(y)},[g,N]=l.useState(!1);return e.jsx("div",{className:"min-h-screen bg-background text-foreground font-sans flex flex-col items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-xl w-full space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-red-500/10 text-red-500 animate-pulse",children:e.jsx(f,{className:"w-10 h-10"})}),e.jsx("h1",{className:"text-4xl font-bold tracking-tight",children:"Rescue Mode Active"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Your site is experiencing issues. We can scan for conflicts and fix them automatically."})]}),e.jsxs("div",{className:"bg-card border border-border rounded-2xl p-8 shadow-lg text-center space-y-8",children:[i==="idle"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:E,className:"w-full py-6 text-2xl font-bold text-white bg-red-600 rounded-xl hover:bg-red-700 transition-all shadow-xl shadow-red-600/20 flex items-center justify-center gap-3 group transform hover:scale-[1.02]",children:[e.jsx("span",{children:"Scan for Conflicts"}),e.jsx(T,{className:"w-8 h-8 group-hover:translate-x-1 transition-transform"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This will analyze your debug logs and active plugins."})]}),i==="analyzing"&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"relative w-24 h-24 mx-auto",children:[e.jsx(m.div,{className:"absolute inset-0 border-4 border-red-500/30 rounded-full",animate:{scale:[1,1.1,1],opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0}}),e.jsx(m.div,{className:"absolute inset-0 border-t-4 border-red-500 rounded-full",animate:{rotate:360},transition:{duration:1.5,repeat:1/0,ease:"linear"}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Analyzing System..."}),e.jsx("p",{className:"text-muted-foreground",children:"Checking debug logs and plugin signatures."})]})]}),i==="fixed"&&e.jsx("div",{className:"space-y-6 text-left",children:s!=null&&s.suspicions&&s.suspicions.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 p-6 rounded-xl",children:[e.jsxs("h3",{className:"text-lg font-bold text-red-600 flex items-center gap-2 mb-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Conflict Detected"]}),e.jsx("p",{className:"text-foreground font-medium text-lg mb-1",children:s.suspicions[0].name||s.suspicions[0].slug}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.suspicions[0].reason})]}),u==="idle"&&!s.fix_applied&&e.jsxs("button",{onClick:O,className:"w-full py-4 text-lg font-bold text-white bg-red-600 hover:bg-red-700 rounded-xl transition-colors shadow-lg shadow-red-600/20 flex items-center justify-center gap-2",children:[e.jsx(b,{className:"w-6 h-6"}),"Deactivate Plugin & Fix Site"]}),u==="fixing"&&e.jsxs("div",{className:"flex items-center justify-center gap-3 py-4 text-lg font-medium text-muted-foreground",children:[e.jsx(m.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(b,{className:"w-6 h-6"})}),"Deactivating plugin..."]}),(u==="fixed"||s.fix_applied)&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 p-6 rounded-xl text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-green-500/20 text-green-600 mb-3",children:e.jsx(v,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-green-600 mb-2",children:"Issue Resolved"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"The conflicting plugin has been deactivated. Your site should be accessible now."}),e.jsx("button",{onClick:()=>window.location.href="/wp-admin",className:"w-full py-3 bg-primary text-primary-foreground hover:bg-primary/90 rounded-xl font-medium transition-colors",children:"Go to WP Admin"})]})})]}):e.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 p-6 rounded-xl text-center space-y-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-green-500/20 text-green-600",children:e.jsx(v,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-xl font-bold text-green-600",children:"No Obvious Conflicts"}),e.jsx("p",{className:"text-muted-foreground",children:"We couldn't identify a specific plugin causing the crash. Check the logs below for more details."}),e.jsx("button",{onClick:()=>N(!0),className:"text-primary font-medium hover:underline",children:"View Debug Logs"})]})}),i==="error"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-red-500 font-medium",children:(s==null?void 0:s.error)||"Connection failed. Please try again."}),e.jsx("button",{onClick:()=>o("idle"),className:"text-sm underline",children:"Retry"})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:()=>N(!g),className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:g?"Hide Advanced Options":"Show Advanced Options"})}),g&&e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsxs("div",{className:"bg-card border border-border rounded-2xl p-6 shadow-sm space-y-4 text-left",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-amber-500"}),"Recent Errors"]}),e.jsx("div",{className:"bg-muted rounded-lg p-4 font-mono text-xs text-muted-foreground whitespace-pre-wrap max-h-[300px] overflow-y-auto",children:s!=null&&s.debug_log_tail&&s.debug_log_tail.length>0?s.debug_log_tail.slice(-20).join(`
`):e.jsx("span",{className:"italic opacity-50",children:"No logs available yet. Run diagnosis to fetch logs."})})]}),e.jsxs("div",{className:"bg-card border border-border rounded-2xl p-6 shadow-sm space-y-4 text-left",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-primary"}),"Developer Email"]}),h==="idle"&&e.jsx("button",{onClick:R,disabled:i!=="fixed",className:"w-full h-10 bg-secondary hover:bg-secondary/80 rounded-md text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Generate Draft"}),h==="generating"&&e.jsxs("div",{className:"flex items-center justify-center gap-2 py-2 text-sm text-muted-foreground",children:[e.jsx(b,{className:"w-4 h-4 animate-spin"}),"Writing email..."]}),h==="generated"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{className:"w-full h-32 bg-muted border border-input rounded-md p-3 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-ring",value:y,readOnly:!0}),e.jsxs("button",{onClick:A,className:"w-full h-10 bg-primary text-primary-foreground hover:bg-primary/90 rounded-md text-sm font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"Copy to Clipboard"]})]})]})]})]})})},S=document.getElementById("wprai-rescue-root");S?P(S).render(e.jsx(D.StrictMode,{children:e.jsx(M,{})})):console.error("WP RescueMode AI: Root element #wprai-rescue-root not found");
